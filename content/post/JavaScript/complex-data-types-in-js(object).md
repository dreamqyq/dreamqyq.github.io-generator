---
title: "JS里的复杂数据类型：object对象"
date: 2018-06-09
draft: false
categories: ["JavaScript"] 
tags: ["JavaScript"]
---

**前言：**[上一遍博客](https://www.jianshu.com/p/61d3b493ad00)介绍了JS中的五种简单数据类型，这篇博客主要介绍JS中的复杂数据类型，**object对象**。注：本文参考阮一峰JS教程中关于对象的介绍，然后结合自己的理解写成，附带[链接](http://javascript.ruanyifeng.com/grammar/object.html) 。

---

## 1、概述

什么是对象？简单说，对象就是一组“键值对”（key-value）的集合，是一种无序的复合数据集合。
对象的所有键名都是字符串（ES6 又引入了 Symbol 值也可以作为键值），所以加不加引号都可以。如果键名是数值的时候，会被自动转为字符串。所以“键名可以是数值”这句话是错误的。**如下列代码，看着键名是数值，但实际上它们已经被转换成字符串了。**
```js
var obj = {
  1: 'a',
  3.2: 'b',
  1e2: true,
  1e-2: true,
  .234: true,
  0xFF: true
};
```
但是，当键名不加引号的时候，则其必须符合标识名的条件（比如第一个字符不能为数字，或者不能含有空格或运算符），且也不是数字，否则会报错。

## 2、对象的引用

如果不同的变量名指向同一个对象，那么它们都是这个对象的引用，也就是说指向同一个内存地址。修改其中一个变量，会影响到其他所有变量。
如：
```js
var o1 = {};"hello world"
var o2 = o1;

o1.a = 1;
o2.a // 1

o2.b = 2;
o1.b // 2
```
上面代码中，o1和o2指向同一个对象，因此为其中任何一个变量添加属性，另一个变量都可以读写该属性。

此时，如果取消某一个变量对于原对象的引用，不会影响到另一个变量。
```js
var o1 = {};
var o2 = o1;

o1 = 1;
o2 // {}
```
**注意**：上述规律只适用于对象，如果是变量的话，即两个变量指向同一个原始类型的值。那么，变量这时都是值的拷贝。如：
```js
var x = 1;
var y = x;

x = 2;
y // 1
```

## 3、表达式还是语句？

这么一行代码，你觉得它是语句还是对象：`{ foo: 123 }`，很多人会说，很显然嘛，大括号里面的是一个"键值对"的形式，肯定表示对象。
但是计算机没有那么智能，JavaScript 引擎读到上面这行代码，会发现可能有两种含义。第一种可能是，这是一个表达式，表示一个包含foo属性的对象；第二种可能是，这是一个语句，表示一个代码区块，里面有一个标签foo，指向表达式123。

为了避免这种歧义，JavaScript 规定，**如果行首是大括号，一律解释为语句（即代码块）。如果要解释为表达式（即对象），必须在大括号前加上圆括号**。所以，这句话`{ foo: 123 }` JS会将其解读成语句。
那么想表示对象该怎么写呢，举个例子：
`({ foo: 123})`
  

## 4、对象中属性的读取

读取对象的属性，有两种方法，一种是使用**点运算符**，如`obj.p`，还有一种是使用**方括号运算符**，如`obj['p'] `。很明显，我们平常使用最多的方式还是点运算符。不过还是有几个坑容易踩（JS中总是有很多坑），下面大致介绍一下两种方法需要注意的地方。

- 如果使用方括号运算符，键名必须放在引号里面，否则会被当作变量处理。
- 方括号运算符内部还可以使用表达式。如`obj['hello' + ' world']`、
`obj[3 + 3]`，获取的是运算后的结果的属性，比如`obj[3 + 3]`获取的是`obj[6]`的属性，哪怕它其中有一个键名是'3+3'，也是获取不到的，想要获取键名是'3+3'的属性 ，得这么写``obj['3 + 3']``。
- 数字键可以不加引号，因为会自动转成字符串。
- 数值键名不能使用点运算符（因为会被当成小数点），只能使用方括号运算符。
- 想使用点运算符，键名必须的符合标示符规范

所以很显然，虽然点运算符写代码是时候方便，但是也容易不小心踩到坑，需要注意很多；方括号运算符不用考虑太多，只是写起来稍微麻烦一点，怎么取舍就要看官自己决定啦。



## 5、对象中属性的赋值

点运算符和方括号运算符，不仅可以用来读取值，还可以用来赋值。
JavaScript 允许属性的“后绑定”，也就是说，你可以在任意时刻新增属性，没必要在定义对象的时候，就定义好属性。（具体原因参看第2条）

## 6、操作对象的几种命令

- 查看一个对象本身的所有属性，可以使用`Object.keys`方法。举例说明：
```js
var obj = {
  key1: 1,
  key2: 2
};

Object.keys(obj);
// ['key1', 'key2']
```

- `delete`命令用于删除对象的属性，删除成功后返回true。需要注意的是：删除一个不存在的属性，delete不报错，而且返回true。

- `in`运算符用于检查对象是否包含某个属性（注意，检查的是键名，不是键值），如果包含就返回true，否则返回false。举例说明：
```js
var obj = { p: 1 };
'p' in obj // true
```

- `for…in` 循环，用来遍历一个对象的全部属性。举个栗子：
```js
var obj = {a: 1, b: 2, c: 3};

for (var i in obj) {
  console.log(obj[i]);
}
// 1
// 2
// 3
```
当然，使用for…in循环也可以便利对象的属性名，即键值：
```js
var obj = {
  x: 1,
  y: 2
};
var props = [];
var i = 0;

for (var p in obj) {
  props[i++] = p
}

props // ['x', 'y']
```
不过使用for…in循环有以下两点需要注意：
1. 它遍历的是对象所有可遍历（enumerable）的属性，会跳过不可遍历的属性。
2. 它不仅遍历对象自身的属性，还遍历继承的属性。

- `with`语句，它的作用是操作同一个对象的多个属性时，提供一些书写的方便。
举个栗子：
```js
with (document.links[0]){
  console.log(href);
  console.log(title);
  console.log(style);
}
// 等同于
console.log(document.links[0].href);
console.log(document.links[0].title);
console.log(document.links[0].style);
```
**注意1**：如果with区块内部有变量的赋值操作，必须是当前对象已经存在的属性，否则会创造一个当前作用域的全局变量。

**注意 2**：with语句的一个很大的弊病，就是绑定对象不明确。所以一般情况不建议使用with语句。


